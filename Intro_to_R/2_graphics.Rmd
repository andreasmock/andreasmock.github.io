---
title: "Teil 2: Graphiken"
author:
- name: Andreas Mock
  affiliation: Nationales Centrum für Tumorerkrankungen (NCT) Heidelberg
  email: andreas.mock@med.uni-heidelberg.de
output:
  rmarkdown::html_document:
    theme: cosmo
    toc: false
    toc_float: false
---

```{r, echo=FALSE, message=FALSE}
library(gdata)
library(ggplot2)
```

## Einführung

Obwohl *R* fast alle Funktionaliäten der modernen Datenanalyse in der biomedizinischen Forschung bietet, benutzen viele Wissenschaftler *R* ausschließlich, um maßgeschneiderte Abbildung für Publikationen etc. zu erstellen. 

## Base graphics

"Out of the box" bietet *R*, die sogenannten *base graphics*, die ohne die Installation eines weiteren Paketes nutzbar sind. Die wichtigste Funktionen sind hierbei `plot`, `hist`, `barplot` und`boxplot`, die eine Reihe von Objekten automatisch erkennen und entsprechend Visualisierungen erstellen. Mithilfe der Funktion `par` können zudem die Graphikparameter angepasst (z.B. 4 Subplots mit dem Argument `mfrow`).

```{r}
# draw random overall survival (days)
os <- rnorm(n=1000,
           mean=100,
           sd = 30)

par(mfrow=c(2,2))
plot(os[1:20])
hist(os)
barplot(os[1:20])
boxplot(os)
```

Der Vorsteil der *Base graphics* Funktionen ist, dass sie leicht anzuwenden und zu erlernen sind und dass sie mit einigen wenigen Einstellungen ansprechend gestaltet werden können:

```{r}
par(mfrow=c(2,2))
plot(os[1:20], bty="n", pch=20, ylab="survival")
hist(os, breaks=10, col="brown", main="")
barplot(os[1:20], border = "white", col="darkgreen", ylab="survival")
boxplot(os, frame=FALSE, ylab="survival", col="grey")
```

## ggplot2

Gilt es mehere Daten miteinander in Beziehung zu setzen und Assoziationen zu eruieren werden die *base graphics* Funktionen jedoch schnell umständlich. So hat sich in den letzten Jahren in weiten Teilen der Datenvisualisierung mit *R* die Syntax des so genannten `ggplot2` Pakets durchgesetzt. Auch wenn es didaktisch nicht ideal sein mag, soll im Folgenden auch die Funktionsweise von Plots mit dem `ggplot2` Pakets präsentiert werden, da sich mit Hilfe von `ggplot2` viele  Datenumformattierungen umgehen lassen und so der Fokus auf der Datenexplorarion liegen kann.

Die Grundfunktion lautet `ggplot`. Wie auch schon in *base graphics* ist das erste Argument der Funktion das Objekt welches wir Visualisieren wollen, im Falle von `ggplot` einen *dataframe*:

```{r, eval=FALSE}
# Paket ggplot2 installieren
install.packages("ggplot2")
library(ggplot2)
```


```{r}
df <- data.frame(survival = rnorm(n=1000,mean=100,sd = 30),
                grade=sample(x = c("G1","G2","G3"),
                             size = 1000, replace = TRUE,prob = c(3,2,1)),
                age=rnorm(n=1000,50,sd=30))
```

```{r, fig.width=4, fig.height=3}
ggplot(df, aes(x=survival, y=age))
```

### Dot plot

```{r, fig.width=4, fig.height=3}
ggplot(df, aes(x=survival, y=age)) +
    geom_point()
```

### Boxplot

```{r, fig.width=4, fig.height=3}
ggplot(df, aes(x=grade, y=survival)) +
    geom_boxplot()
```

```{r, fig.width=4, fig.height=3}
ggplot(df, aes(x=grade, y=survival, fill=grade)) +
    geom_boxplot()
```

### Histogramm

```{r, fig.width=4, fig.height=3}
ggplot(df, aes(x=survival)) +
    geom_histogram()
```

### Density plot

```{r, fig.width=4, fig.height=3}
ggplot(df, aes(x=survival)) +
    geom_density() +
    theme_minimal()
```


### 2D Density plot

```{r, fig.width=4, fig.height=3}
ggplot(df, aes(x=survival, y=age)) +
    geom_density2d() +
    theme_minimal()
```

Mehr Informationen zu den Funktionalitäten von `ggplot` finden sich auf der [Entwicklerhomepage](http://ggplot2.tidyverse.org).


## Beispieldaten

**Integrated Genomic Characterization of Pancreatic Ductal Adenocarcinoma**  
*Cancer Cell*. **Volume 32** Issue 2: p185-203

```{r, eval=FALSE}
# Packet gdata installieren
install.packages("gdata")
library(gdata)
```

```{r}
padc = read.xls(xls="http://www.cell.com/cms/attachment/2106066377/2081438868/mmc2.xlsx",
                skip=1)
```


## Übung (ca. 30 min.)

Nutzt die oben aufgeführten Funktionen zur Visualisierung der Pankreasmetadaten

Als Startpunkt:

```{r, fig.height=2}
ggplot(padc, aes(x=Grade)) +
    geom_bar() +
    coord_flip()
```


