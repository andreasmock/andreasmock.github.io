---
title: "Angewandte Datenanalyse mit `R`"
subtitle: "Tag 1 - Einführung in Programmierung mit `R` "
author: "Andreas Mock"
institute: "Abteilung für Medizinische Onkologie, Nationales Centrum für Tumorerkrankungen (NCT) Heidelberg"
date: "Sommersemester 2018"
output:
  beamer_presentation:
    fig_width: 3.5
    fig_height: 2.5
    fig_caption: false
    includes:
      in_header: header.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(wordcloud)
library(tidyverse)
```

## Hands-On Praktikum: Angewandte Datenanalyse mit `R`

### Organisatorisches - Sommersemester 2018

Kursunterlagen: [http://andreasmock.github.io/teaching](http://andreasmock.github.io/teaching)

Kontakt: [andreas.mock@med.uni-heidelberg.de](andreas.mock@med.uni-heidelberg.de)

Ort: K1, NCT 1.OG

**Kurszeiten**

- 05.06.2018 - 15:30 - 17:00 Uhr
- 12.06.2018 - **16:30 - 18:00 Uhr**
- 26.06.2018 - 15:30 - 17:00 Uhr

## Hands-On Praktikum: Angewandte Datenanalyse mit `R`

### Kursinhalte

- Tag 1: Einführung in Programmierung mit R 
- Tag 2: Datentransformation und -visualisierung
- Tag 3: Datenimport und -modellierung

### Kursunterlagen 

|Tag 1| Tag 2| Tag 3|
|-------|-------|-------|
|[Präsentation](http://andreasmock.github.io/intro_pres.pdf)|Präsentation| Präsentation|
|[Übungen](http://andreasmock.github.io/day1.html)|Übungen|Übungen|
|Lösungen|Lösungen|Lösungen|

Die Lösungen zu den Übungen werden am Ende des jeweiligen Tages online gestellt.

## Translationale Onkologie 2018

```{r, echo=FALSE, warnings=F, message=F, fig.align='center', fig.width=7, fig.height=7}
words = c("Data Science","Precision", "Big Data","Personalized","Systems Biology","Synthetic","Cloud","Apps","E-Health","Prediction","Prevention","Translation","Omics","High-Throughput","Seq","Machine Learning","Gene Editing","Immunotherapy","Virotherapy")
set.seed(8)
freq = c(7,5,1,1,1,2,3,4,4,5,3,3,3,2,2,4,3,4,3)
wordcloud(words=words,freq=freq,min.freq = 1,
          max.words=200, random.order=FALSE, rot.per=0.5, 
          colors=brewer.pal(8, "Dark2"))
```

## Was ist R?

- `R` ist eine **freie Programmiersprache** für statistische Berechnungen und Grafiken.
-  Obwohl `R` bereits alt ist (Erscheinungsjahr 1993) gilt diese als **Standardsprache** für statistische Problemstellungen in Wirtschaft und Wissenschaft
- $>$ **11.000 Formelsammlungen** für spezifische Fragestellungen (sog. Pakete)
- Hoch-qualitative und individuelle **Grafiken** - viele Wissenschaftler benutzen `R` nur hierzu
- Sowohl `R`, als auch alle Pakete sind **kostenlos**!!

## RStudio

Grafische Benutzeroberfläche und Entwicklungsumgebung für `R`

![](../pics/rstudio-console.png){width=300px}

R for Data Science, Hadley Wickham & Garrett Grolemund 2016



## Data Science

![](../pics/data-science.png){width=330px}

R for Data Science, Hadley Wickham & Garrett Grolemund 2016

## Weiterführende Literatur


**Programmieren mit R**  
Hands-On Programming with R, Garrett Grolemund  
- Kapitel 1, 2, 3, 4, 5, 7, 9    
[\small Link](https://d1b10bmlvqabco.cloudfront.net/attach/ighbo26t3ua52t/igp9099yy4v10/igz7vp4w5su9/OReilly_HandsOn_Programming_with_R_2014.pdf) 

>

**Die "Bibel" für R User**  
R for Data Science, Hadley Wickham & Garrett Grolemund    
[\small Link](http://r4ds.had.co.nz)

>

**Kochbuch für R Plots**  
R Graphics Cookbock, Winston Chang      
[\small Link](http://www.cookbook-r.com)



# R Coding 101

## R Architektur

R ist eine Objekt-orientierte Programmiersprache. Es dreht sich daher im Grunde alles darum Objekte herzustellen, zu manipulieren und zu visualisieren.

```{r}
# Zuweisung von Zahlen zu einem Objekt
alter <- 67
```

R ist *case-sensitive* - Groß- und Kleinschreibung ist wichtig!

```{r, error=TRUE}
# Objekt `alter` ausgeben
alter

# .. entspricht nicht
Alter
```



## R Objekttypen

### Vektor

Def: Sammlung mehrerer Objekte gleicher Art (Länge 1 ist möglich).

```{r}
# numerischer Vektor mit Länge 1
x1 <- 5 

# Charaktervektor mit Länge 1 (Text wird in "" gesetzt)
x2 <- "green"

# Vektoren mit Länge 3
y1 <- c(1,3,9)
y2 <- c("gene1","gene2","gene3")
```
Subsetting:

```{r}
# um den vollständigen Vektor y2 auszugeben
y2

# um nur die ersten beiden Einträge des Vektors y2 auszugeben
y2[1:2]
```

## R Objekttypen

### Matrix

Kombination mehrerer Vektoren gleichen Typs (numerisch oder Charakter). Die Matrix kann
Zeilen- und Spaltennamen haben.

```{r}
matrix <-  cbind(y1, y1, y1)
rownames(matrix)  <-  y2
colnames(matrix) <-  c("sample1","sample2","sample3")
matrix
```


## R Objekttypen

### Matrix

Ein Subset kann man sich mit der folgenden Syntax anzeigen lassen:

```{r, eval=F}
matrix[Zeile,Spalte]
```

Bespiele hierfür sind:

```{r}
matrix[1,]
matrix[,3]
matrix[1:2,]
```

## R Objekttypen

### Dataframe

Im Gegensatz zu Matrizen können in *Dataframes* Vektoren verschiedenen Typs (z.B. numerischer Vektor und Charaktervektor) miteinander kombiniert werden. Wichtig: Die Vektoren müssen die gleiche Länge haben. 

```{r}
df <- data.frame(age=c(50,47,87),
                gender=c("male","male","female"))
df
```

Somit eignen sich *Dataframes* insbesondere für die Analyse von Patientenmetadaten im Rahmen von molekularbiologischen Experimenten oder klinischen Studien.

## R Objekttypen


### Dataframe

```{r}
df
```

Eine Besonderheit von *Dataframes* ist die Möglichkeit einzelne Spalten durch den Spaltennamen zu selektieren.

```{r}
df$age
```

Dies entspricht der folgenden Matrixnotation

```{r}
df[,1]
```


## R Objekttypen


![](../pics/R_objects.pdf)

Die Funktion `class` ermöglicht es den Typ eines Objektes zu eruieren:

```{r}
class(df)
```


## R Objekttypen

### Funktionen

Die Grundsyntax einer jeden Funktion ist

```{r, eval=FALSE}
function(Objekt, Argumente)
```

Die Argumente sind hierbei fakultativ. R besitzt eine Vielzahl von Funktionen, ohne dass zusätzliche Packete geladen werden müssen. 

```{r}
sum(y1)
mean(y1)
```

Die Funktion `help` öffnet die Dokumentation in RStudio und zeigt die notwendigen Objekte und Argumente zu jeder Funktion an. Als Beispiel, was genau macht die Funktion `cbind`?

```{r}
help(cbind)
```

## R Packete 

Ein Paket ist nicht anderes als eine wohldurchdachte Formelsammlung, die für eine spezifische wissenschaftliche Fragestellung (z.B. die Analyse von Sequenzierungsdaten) entwickelt wurde.  

Installation

```{r, eval=FALSE}
install.packages("tidyverse")
```

Ins Environment laden

```{r, eval=FALSE}
library(tidyverse)
```

# Installations- und Kaffeepause

# R Datenexploration 101

## Bespieldaten des Kurses

Metadaten des *The Cancer Genome Atlas (TCGA)* zur Analyse von Kopf-Hals-Tumoren (head and neck squamous cell carcinoma; HNSCC). Der Datensatz fasst die wichtigsten klinisch-pathologischen Charakteristika der Studienkohorte (n=279) zusammen.

[Link zur Originalpublikation](https://tcga-data.nci.nih.gov/docs/publications/hnsc_2014/)

```{r}
#Datensatz in R laden
load(url("http://andreasmock.github.io/data/hnscc.RData"))
```

## Bespieldaten des Kurses

```{r}
hnscc
```

## Exploration des `hnscc` Datensatzes

```{r}
colnames(hnscc)
```

```{r}
head(hnscc$age)
```

```{r}
summary(hnscc$age)
```

## Exploration des `hnscc` Datensatzes

```{r}
head(hnscc$alcohol)
```

```{r}
table(hnscc$alcohol)
```

```{r}
table(is.na(hnscc$alcohol))
```

## Exploration des `hnscc` Datensatzes

```{r}
summary(hnscc$days_to_death)
```

```{r}
table(hnscc$gender)
```

```{r}
table(hnscc$neoplasm_site)
```

```{r}
table(hnscc$grade)
```

## Exploration des `hnscc` Datensatzes

```{r}
summary(hnscc$pack_years)
```

```{r}
table(hnscc$tabacco_group)
```

## Exploration des `hnscc` Datensatzes

```{r}
table(hnscc$tumor_stage)
```

```{r}
table(hnscc$vital_status)
```

## Funktionen zur Exploration von Datensätzen

```{r, eval=FALSE}
# Tabelle von kategoriellen Daten
table(<data>)

# Tabelle von fehlenden Informationen
table(is.na(<data>))

# Summary von kontinuierlichen Daten
summary(<data>)
```


# R Plotting 101

## ggplot2 Paket

Visualisierungen mit dem `ggplot2` Paket (Teil des `tidyverse` Pakets) neuer Standard in R.   

Prinzip: Malen eines Gemähldes - Schicht für Schicht.

Metadaten des Bespieldatensatzes, die wir explorieren können:

```{r}
colnames(hnscc)
```


## Funktionsweise der ggplot Funktion

Leere Leinwand. `age` auf der x-Achse und `days_to_death` auf der y-Achse.

```{r}
ggplot(hnscc, aes(x=age, y=days_to_death))
```

## Funktionsweise der ggplot Funktion

Dotplot

```{r, warning=FALSE}
ggplot(hnscc, aes(x=age, y=days_to_death)) +
    geom_point()
```

# Fragen?


