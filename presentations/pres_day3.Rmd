---
title: "Angewandte Datenanalyse mit `R`"
subtitle: "Tag 3 - Datenimport und -modellierung"
author: "Andreas Mock"
institute: "Abteilung für Medizinische Onkologie, Nationales Centrum für Tumorerkrankungen (NCT) Heidelberg"
date: "Sommersemester 2018"
output:
  beamer_presentation:
    fig_width: 2
    fig_height: 2
    fig_caption: false
    includes:
      in_header: header.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(wordcloud)
library(tidyverse)
```

## Ablauf - Tag 3

- Datenimport mit `readr` und `readxl`
- Datenmodellierung
- Häufige Missverständnisse über den p-Wert


![](../pics/data-science-wrangle.png){width=300px}


# Datenimport

## Dateipfade

1) Wie finde ich den **absoluten** Dateipfad heraus, in dem sich meine R Umgebung befindet, das so genannte *working directory*?

```{r}
getwd()
```

2) Welche Dateien befinden sich in dem aktuellen Dateipfad?

```{r}
list.files()
```

## Dateipfade

3) Wie kann ich ausgehend vom *working directory* einen **relativen** Dateipfad angeben?

Mit dem Präfix `../` lässt sich eine Ordnereben, mit `../../` entsprechend 2 Ebenen nach oben gehen.

Der relative Pfad

```{r}
list.files("../")
```

entspricht damit dem **absoluten** Dateipfad

```{r, eval=FALSE}
list.files("/Users/Andy/Documents/Research/Github_page")
```

## Dateipfade

4) Wie kann ich Daten aus dem Internet einlesen?

Einfach den Webpfad benutzen:

```{r, eval=F}
library(readxl)
path <- paste0("https://tcga-data.nci.nih.gov/docs/publications/sarc_2017/",
               "SARC_264_Fusion_Gene_Profiles.txt")

read_tsv(file = path)
```

## Datenimport

Benötigte Packete: `readr` Paket im `tidyverse`, sowie das bisher noch nicht verwendete Paket `readxl`.

Funktionen zum Import nach Dateityp:

- `read_tsv`: tab-separated file
- `read_csv`: comma-separated file
- `read_xlsx` bzw. `read_xls`: Excel spread sheet
- `read_delim`: file mit beliebig anzugebendem delimiter, also Trennzeichen

# Datenmodellierung

## Datenmodellierung

HNSCC Datensatz laden

```{r}
load(url("http://andreasmock.github.io/data/hnscc.RData"))
```

## T-Test

Der T-Test ist ein parametrischer (geht von normalverteilten Daten aus) Hypothesentest zum Vergleich von kontinuierlichen Daten zweier Gruppen.

```{r, fig.width=1.5, fig.height=1.5}
ggplot(hnscc, aes(x=gender, y=age)) +
    geom_boxplot()
```

## T-Test

```{r}
t.test(age ~ gender, data=hnscc)
```

## ANOVA (analysis of variance)

ANOVA bietet die Möglichkeit mehr als 2 Gruppen miteinander zu vergleichen.

```{r, fig.width=6, fig.height=3}
ggplot(hnscc, aes(x=tabacco_group, y=age)) +
    geom_boxplot() +
    coord_flip()
```

## ANOVA (analysis of variance)

```{r}
summary(aov(age ~ tabacco_group, data=hnscc))
```

## Korrelationstest

```{r, fig.width=1.5, fig.height=1.5, warning=FALSE}
ggplot(hnscc, aes(x=age, y=pack_years)) +
    geom_point() +
    geom_smooth(method="lm")
```

```{r}
cor.test(~ age + pack_years, data=hnscc)
```

# Häufige Missverständnisse über den p-Wert

## Der Erfinder des p-Wertes

\begincols
  \begincol{.48\textwidth}

![](Fisher.jpg){width=150px}

**Sir Ronald Fisher (1890-1962)**  
Gonville & Caius College, Cambridge

  \endcol
\begincol{.48\textwidth}

”Personally, the writer prefers to set a low standard of significance at the 5 percent point [...] A scientific fact should be regarded as experimentally established **only if** a properly designed **experiment rarely fails to give this level of significance**.“

\vspace{1em}

\textit{Statistical Methods for Research Workers, 1926}

  \endcol
\endcols

## Definition des p-Wertes

Wahrscheinlichkeit das gleiche Stichprobenergebnis oder ein noch extremeres zu erhalten, wenn die Nullhypothese wahr ist.

\vspace{1em}

Algebraische Definition: P(X $\geq$ x $\mid$~ $H_0$) wobei $X$ eine Zufallsvariable und $x$ der beobachte Wert in den Daten ist 

![](bell_curve.png){width=250px}

Goodman, 2008

## #1 | Wenn p<0.05, ist die Nullhypothese nur in 5% wahr

Dies ist die wohl \textbf{häufigste Fehlinterpretation} des p-Wertes. 
\vspace{1em}

Der p-Wert wird unter der Annahme berechnet, dass die Nullhypothese zutrifft (P(Daten $\mid$~$H_0$)), er kann daher nicht gleichzeitig die Wahrscheinlichkeit sein, dass die Nullhypothese zutrifft (P($H_0$ $\mid$ Daten)).

\vspace{1em}

\textbf{Beispiel}: Die Wahrscheinlichkeit drei Mal hintereinander Kopf beim M"unzwurf zu erhalten ist p=0.125. Dies bedeutet jedoch nicht, dass die Wahrscheinlichkeit, dass die Münze fair ist nur 12.5% beträgt.

## #2 | p>0.05 bedeutet, dass es keinen Unterschied zwischen den Gruppen gibt

Eine nicht signifikante Differenz bedeutet bloß, dass die beobachten **Daten konsistent mit der Nullhypothese** sind und nicht, dass die Nullhypothese wahrscheinlicher ist.

## #3 | p=0.06 ist substantiell schlechter als p=0.04

Fisher hat den p-Wert als **kontinuierliche Variable** eingeführt um abzuschätzen, ob ein Ergebnis es Wert ist weiter untersucht zu werden. Die magische p-Wert Grenze von 0.05 ist völlig arbiträr. p-Werte von 0.04 und 0.06 sind sehr  ähnliche Wahrscheinlichkeiten!

![](bell_curve.png){width=250px}

Goodman, 2008

## #4 | Studien mit gleichem p-Wert zeigen eine ähnlich starke Effektgröße

Der folgende Plot zeigt, dass dies nicht zutrifft. Der gleiche p-Wert kann einen völlig anderen Effekt indizieren (Fig. B). Umgekehrt, kann es einen identischen Effekt bei unterschiedlichem p-Wert geben (Fig. A):

![](effect.tiff){width=250px}

Goodman, 2008

## #5 | p=0.05 bedeutet, dass man bei Wiederholung des Experiments in 5% ein nicht signifikantes Ergebnis erhält
 
 
![](simulation.pdf)

Nur bei einer **großen Effektgröße** bzw. **Power**
(i.e. Gruppengrößee) sind p-Werte bei Wiederholung des Experiments mit einer anderen Stichprobe reproduzierbar!

## Literatur zum Thema 

**A Dirty Dozen: Twelve P-Value Misconceptions**  
Goodman, S  
Semin Hematol. 2008 Jul;45(3):135-40.

\vspace{1em}

**The fickle P value generates irreproducible results**  
Halsey LG, Curran-Everett D, Vowler SL & Drummond GB   
Nat Methods. 2015 Mar;12(3):179-85.  
